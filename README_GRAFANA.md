# RAG Performance Dashboard with Grafana

This setup provides a professional, real-time dashboard for monitoring your RAG system performance.

## ðŸš€ Quick Start

### 1. Install Grafana
```bash
chmod +x setup_grafana.sh
./setup_grafana.sh
```

### 2. Configure Dashboard
```bash
python setup_grafana_datasource.py
```

### 3. Access Dashboard
- Open: http://localhost:3000
- Login: admin / admin
- Change password when prompted

## ðŸ“Š Dashboard Features

### **Real-time Metrics**
- Total queries processed
- Average response time
- User satisfaction ratings
- Active configurations

### **Performance Charts**
- Response time trends over time
- Query volume by hour
- LLM provider comparisons
- Configuration performance tables

### **Monitoring Capabilities**
- Auto-refresh every 30 seconds
- Historical data analysis
- Performance alerting
- Export capabilities

## ðŸ”§ Manual Setup (Alternative)

If the automatic setup doesn't work:

### 1. Add SQLite Datasource
1. Go to Configuration > Data Sources
2. Add new datasource > SQLite
3. Set path to: `/path/to/your/rag_logs.db`
4. Test connection

### 2. Import Dashboard
1. Go to + > Import
2. Upload the dashboard JSON (generated by script)
3. Select SQLite datasource

### 3. Key Queries for Panels

**Total Queries:**
```sql
SELECT COUNT(*) as value FROM queries
```

**Average Response Time:**
```sql
SELECT AVG(response_time_seconds) as value
FROM queries
WHERE response_time_seconds IS NOT NULL
```

**LLM Performance:**
```sql
SELECT
    c.llm_provider,
    COUNT(q.query_id) as queries,
    AVG(q.response_time_seconds) as avg_time,
    AVG(COALESCE(uf.rating, 0)) as avg_rating
FROM configurations c
LEFT JOIN queries q ON c.config_id = q.config_id
LEFT JOIN responses r ON q.query_id = r.query_id
LEFT JOIN user_feedback uf ON r.response_id = uf.response_id
GROUP BY c.llm_provider
```

**Time Series (Response Time):**
```sql
SELECT
    datetime(asked_at) as time,
    AVG(response_time_seconds) as value
FROM queries
WHERE response_time_seconds IS NOT NULL
GROUP BY datetime(substr(asked_at, 1, 16) || ':00')
ORDER BY time
```

## ðŸ”” Setting Up Alerts

### High Response Time Alert
1. Go to Alerting > Alert Rules
2. Create new rule:
   - Query: `SELECT AVG(response_time_seconds) FROM queries WHERE asked_at >= datetime('now', '-5 minutes')`
   - Condition: IS ABOVE 5 (seconds)
   - Evaluation: Every 1m for 2m

### Low Rating Alert
1. Create new rule:
   - Query: `SELECT AVG(rating) FROM user_feedback WHERE submitted_at >= datetime('now', '-10 minutes')`
   - Condition: IS BELOW 3
   - Evaluation: Every 2m for 5m

## ðŸ“ˆ Dashboard Panels Explained

### **Stat Panels (Top Row)**
- **Total Queries**: Count of all queries processed
- **Avg Response Time**: Mean response time with color thresholds
- **Avg Rating**: User satisfaction with 5-star scale
- **Active Configs**: Number of configurations used recently

### **Time Series Charts**
- **Response Time Over Time**: Shows performance trends
- **Queries Per Hour**: Shows usage patterns

### **Tables**
- **LLM Provider Performance**: Compare Groq vs Cerebras
- **Configuration Performance**: Best parameter combinations

## ðŸŽ¨ Customization

### Adding New Panels
1. Click "Add Panel" on dashboard
2. Write SQL query for your data
3. Choose visualization type
4. Configure display options

### Useful Custom Queries

**Most Popular Questions:**
```sql
SELECT user_question, COUNT(*) as frequency
FROM queries
GROUP BY query_hash
ORDER BY frequency DESC
LIMIT 10
```

**Chunk Size Performance:**
```sql
SELECT
    c.chunk_size,
    AVG(q.response_time_seconds) as avg_time,
    AVG(COALESCE(uf.rating, 0)) as avg_rating
FROM configurations c
JOIN queries q ON c.config_id = q.config_id
LEFT JOIN responses r ON q.query_id = r.query_id
LEFT JOIN user_feedback uf ON r.response_id = uf.response_id
GROUP BY c.chunk_size
```

**Daily Usage Stats:**
```sql
SELECT
    DATE(asked_at) as date,
    COUNT(*) as queries,
    COUNT(DISTINCT session_id) as sessions,
    AVG(response_time_seconds) as avg_time
FROM queries
WHERE asked_at >= datetime('now', '-30 days')
GROUP BY DATE(asked_at)
ORDER BY date
```

## ðŸ”§ Troubleshooting

### Grafana Won't Start
```bash
sudo systemctl status grafana-server
sudo journalctl -u grafana-server -f
```

### SQLite Plugin Issues
```bash
sudo grafana-cli plugins ls
sudo grafana-cli plugins install frser-sqlite-datasource
sudo systemctl restart grafana-server
```

### Database Connection Problems
- Check database path is absolute
- Ensure Grafana has read permissions
- Verify database file exists and has data

### No Data in Charts
- Check time range (top-right corner)
- Verify queries run correctly in SQL tab
- Ensure your RAG system is generating logs

## ðŸŽ¯ Best Practices

1. **Set appropriate time ranges** for different views
2. **Use variables** for dynamic filtering (LLM provider, date range)
3. **Create different dashboards** for different audiences
4. **Set up alerting** for critical metrics
5. **Regular backups** of dashboard configurations

## ðŸ“± Mobile Access

Grafana dashboards work on mobile devices:
- Responsive design
- Touch-friendly controls
- Real-time updates

## ðŸ”’ Security

For production use:
- Change default admin password
- Set up proper authentication
- Configure HTTPS
- Restrict database access

Your professional RAG monitoring dashboard is ready! ðŸŽ‰